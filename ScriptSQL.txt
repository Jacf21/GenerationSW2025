-- Creación de la tabla 'users'
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    tipo VARCHAR(10) NOT NULL CHECK (tipo IN ('est', 'profesor', 'admin'))
);

-- Creación de la tabla 'curso'
CREATE TABLE curso (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(255) NOT NULL,
    fecha_ini DATE NOT NULL,
    fecha_fin DATE NOT NULL,
    codigo VARCHAR(100) NOT NULL
);

-- Creación de la tabla 'topico'
CREATE TABLE topico (
    id SERIAL PRIMARY KEY,
    id_curso INT NOT NULL,
    titulo VARCHAR(255) NOT NULL,
    descripcion TEXT,
    FOREIGN KEY (id_curso) REFERENCES curso(id) ON DELETE CASCADE
);

-- Creación de la tabla 'laboratorio' (Modificada)
CREATE TABLE laboratorio (
    id SERIAL PRIMARY KEY,
    id_curso INT NOT NULL,
    id_topico_inicio INT NOT NULL,
    id_topico_fin INT NOT NULL,
    titulo VARCHAR(255) NOT NULL,
    descripcion TEXT,
    FOREIGN KEY (id_curso) REFERENCES curso(id) ON DELETE CASCADE,
    FOREIGN KEY (id_topico_inicio) REFERENCES topico(id) ON DELETE CASCADE,
    FOREIGN KEY (id_topico_fin) REFERENCES topico(id) ON DELETE CASCADE
);

-- Creación de la tabla 'contenidoTopico'
CREATE TABLE contenidoTopico (
    id SERIAL PRIMARY KEY,
    id_topico INT NOT NULL,
    tipo VARCHAR(50) NOT NULL,
    url VARCHAR(255) NOT NULL,
    FOREIGN KEY (id_topico) REFERENCES topico(id) ON DELETE CASCADE
);

-- Creación de la tabla 'progresoUsuario'
CREATE TABLE progresoUsuario (
    id SERIAL PRIMARY KEY,
    id_usuario INT NOT NULL,
    id_topico INT NOT NULL,
    fecha DATE NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (id_topico) REFERENCES topico(id) ON DELETE CASCADE
);

-- Creación de la tabla 'recursoLaboratorio'
CREATE TABLE recursoLaboratorio (
    id SERIAL PRIMARY KEY,
    id_laboratorio INT NOT NULL,
    url VARCHAR(255) NOT NULL,
    tipo VARCHAR(50) NOT NULL,
    FOREIGN KEY (id_laboratorio) REFERENCES laboratorio(id) ON DELETE CASCADE
);

-- Creación de la tabla 'preguntaLaboratorio'
CREATE TABLE preguntaLaboratorio (
    id SERIAL PRIMARY KEY,
    id_laboratorio INT NOT NULL,
    titulo VARCHAR(255) NOT NULL,
    problema TEXT NOT NULL,
    resultado TEXT,
    FOREIGN KEY (id_laboratorio) REFERENCES laboratorio(id) ON DELETE CASCADE
);

-- Creación de la tabla 'evaluacion'
CREATE TABLE evaluacion (
    id SERIAL PRIMARY KEY,
    id_curso INT NOT NULL,
    fecha_ini DATE NOT NULL,
    fecha_fin DATE NOT NULL,
    nota DECIMAL(5, 2),
    FOREIGN KEY (id_curso) REFERENCES curso(id) ON DELETE CASCADE
);

-- Creación de la tabla 'preguntaEvaluacion'
CREATE TABLE preguntaEvaluacion (
    id SERIAL PRIMARY KEY,
    id_evaluacion INT NOT NULL,
    tipo VARCHAR(50) NOT NULL,
    descripcion TEXT NOT NULL,
    respuesta TEXT,
    FOREIGN KEY (id_evaluacion) REFERENCES evaluacion(id) ON DELETE CASCADE
);

-- Creación de la tabla 'matriculaCurso'
CREATE TABLE matriculaCurso (
    id SERIAL PRIMARY KEY,
    id_usuario INT NOT NULL,
    id_curso INT NOT NULL,
    fecha_matricula DATE DEFAULT CURRENT_DATE, 
    
    UNIQUE (id_usuario, id_curso), 
    FOREIGN KEY (id_usuario) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (id_curso) REFERENCES curso(id) ON DELETE CASCADE
);