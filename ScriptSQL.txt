-- Creación de la tabla users
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    aprobado BOOLEAN NOT NULL,
    verificado BOOLEAN NOT NULL,
    tipo VARCHAR(10) NOT NULL CHECK (tipo IN ('est', 'profesor', 'admin', 'edit')),
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Creación de la tabla 'curso'
CREATE TABLE curso (
    id SERIAL PRIMARY KEY,
    id_usuario INT NOT NULL,
    nombre VARCHAR(255) NOT NULL,
    fecha_ini DATE NOT NULL,
    fecha_fin DATE NOT NULL,
    descripcion VARCHAR(255) NOT NULL,
    codigo VARCHAR(100) NOT NULL,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_usuario) REFERENCES users(id) ON DELETE CASCADE
);

-- Creación de la tabla 'topico'
CREATE TABLE topico (
    id SERIAL PRIMARY KEY,
    titulo VARCHAR(255) NOT NULL,
    orden INT NOT NULL,
    descripcion TEXT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Creación de la tabla 'contenidoTopico'
CREATE TABLE contenidoTopico (
    id SERIAL PRIMARY KEY,
    id_topico INT NOT NULL,
    tipo VARCHAR(50) NOT NULL CHECK (tipo IN ('text', 'img', 'video', 'audio', 'slide', 'eval')),
    url VARCHAR(255) NOT NULL,
    storage_path VARCHAR(255),
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_topico) REFERENCES topico(id) ON DELETE CASCADE
);

-- Creación de la tabla 'pantallaTopico'
CREATE TABLE pantallaTopico (
    id SERIAL PRIMARY KEY,
    id_topico INT NOT NULL,
    id_editor INT NOT NULL,
    visible BOOLEAN NOT NULL,
    descripcion TEXT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_topico) REFERENCES topico(id) ON DELETE CASCADE,
    FOREIGN KEY (id_editor) REFERENCES users(id) ON DELETE CASCADE
);

-- Creacion de la tabla 'contenidoPantallaTopico'
CREATE TABLE contenidoPantallaTopico (
    id SERIAL PRIMARY KEY,
    id_pantalla INT NOT NULL,
    id_contenido INT NOT NULL,
    orden INT NOT NULL;
    tipo_bloque VARCHAR(50) NOT NULL DEFAULT 'default',
    layout JSONB DEFAULT '{}',
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (id_pantalla) REFERENCES pantallaTopico(id) ON DELETE CASCADE,
    FOREIGN KEY (id_contenido) REFERENCES contenidoTopico(id) ON DELETE CASCADE
);